(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{2323:function(e,t,i){"use strict";i.d(t,{p:function(){return R}});var l=i(4390),a=i(9505),n=i.n(a),o=i(3537),r=i.n(o),d=i(6653),s=i(1902),u=i(6970),c=i(1053),m=i(6238),g=i(2129),v=i(1770),h=i(3484),p=i(5581),f=i(5638),y=i(3169),Z=i(5019),w=i(2696),x=i(3370),b=(i(684),i(8651)),k=i(3224),F=i(2716),C=i(2271),$=i(5160),E=i(5249),M=i(1622),D=(i(5500),i(2172));i(9934),i(95),i(7453),i(1839),i(5725),i(938),i(3973),i(9948),i(5836),i(9059),i(2550),i(6837),i(8820);const I=["children"],S=e=>{let{children:t}=e,i=(0,D.Z)(e,I);return(0,c.tZ)("div",(0,l.Z)({css:{minWidth:0,maxWidth:1080}},i),t)};function T(e){const t=(0,s.useRef)(e),i=(0,s.useCallback)((function(){return t.current(...arguments)}),[]);return(0,s.useEffect)((()=>{t.current=e})),i}function q(e){var t,i,l;let{listKey:a,itemGetter:n,selectedFields:o,fieldModes:r,showDelete:d}=e;const u=(0,$.sm)(a),[m,{loading:g,error:v,data:h}]=(0,k.D)(F.Ps`mutation ($data: ${u.gqlNames.updateInputName}!, $id: ID!) {
      item: ${u.gqlNames.updateMutationName}(where: { id: $id }, data: $data) {
        ${o}
      }
    }`,{errorPolicy:"all"});n=null!==(t=(0,s.useMemo)((()=>{if(h)return(0,w.m)(h,null===v||void 0===v?void 0:v.graphQLErrors).get("item")}),[h,v]))&&void 0!==t?t:n;const[p,y]=(0,s.useState)((()=>({value:(0,b.d)(u.fields,n),item:n})));if(!g&&p.item.data!==n.data&&(n.errors||[]).every((e=>{var t;return 1!==(null===(t=e.path)||void 0===t?void 0:t.length)}))){const e=(0,b.d)(u.fields,n);y({value:e,item:n})}const{changedFields:Z,dataForUpdate:C}=(0,b.u)(u.fields,p.item,p.value),E=(0,b.a)(u.fields,p.value),[D,I]=(0,s.useState)(!1),S=(0,f.e)(),q=T((()=>{const e=0!==E.size;I(e),e||m({variables:{data:C,id:p.item.get("id").data}}).then((e=>{let{errors:t}=e;const i=null===t||void 0===t?void 0:t.find((e=>{var t;return 1===(null===(t=e.path)||void 0===t?void 0:t.length)}));i?S.addToast({title:"Failed to update item",tone:"negative",message:i.message}):S.addToast({tone:"positive",title:"Saved successfully"})})).catch((e=>{S.addToast({title:"Failed to update item",tone:"negative",message:e.message})}))})),R=null===(i=p.item.data)||void 0===i?void 0:i[u.labelField],z=null===(l=p.item.data)||void 0===l?void 0:l.id;return(0,M.u)(!!Z.size),(0,c.tZ)(c.xu,{marginTop:"xlarge"},(0,c.tZ)(M.G,{networkError:null===v||void 0===v?void 0:v.networkError,errors:null===v||void 0===v?void 0:v.graphQLErrors.filter((e=>{var t;return 1===(null===(t=e.path)||void 0===t?void 0:t.length)}))}),(0,c.tZ)(x.F,{fieldModes:r,fields:u.fields,forceValidation:D,invalidFields:E,onChange:(0,s.useCallback)((e=>{y((t=>({item:t.item,value:e(t.value)})))}),[y]),value:p.value}),(0,c.tZ)(L,{onSave:q,hasChangedFields:!!Z.size,onReset:T((()=>{y((e=>({item:e.item,value:(0,b.d)(u.fields,e.item)})))})),loading:g,deleteButton:(0,s.useMemo)((()=>d?(0,c.tZ)(N,{list:u,itemLabel:null!==R&&void 0!==R?R:z,itemId:z}):void 0),[d,u,R,z])}))}function N(e){let{itemLabel:t,itemId:i,list:l}=e;const a=(0,f.e)(),[n,{loading:o}]=(0,k.D)(F.Ps`mutation ($id: ID!) {
      ${l.gqlNames.deleteMutationName}(where: { id: $id }) {
        id
      }
    }`,{variables:{id:i}}),[r,m]=(0,s.useState)(!1),g=(0,d.useRouter)();return(0,c.tZ)(s.Fragment,null,(0,c.tZ)(u.zx,{tone:"negative",onClick:()=>{m(!0)}},"Delete"),(0,c.tZ)(h.aR,{title:"Delete Confirmation",isOpen:r,tone:"negative",actions:{confirm:{label:"Delete",action:async()=>{try{await n()}catch(e){return a.addToast({title:`Failed to delete ${l.singular} item: ${t}`,message:e.message,tone:"negative"})}return g.push(`/${l.path}`),a.addToast({title:t,message:`Deleted ${l.singular} item successfully`,tone:"positive"})},loading:o},cancel:{label:"Cancel",action:()=>{m(!1)}}}},"Are you sure you want to delete ",(0,c.tZ)("strong",null,t),"?"))}const R=e=>()=>(0,c.tZ)(z,e),z=e=>{var t,i,a,o;let{listKey:h}=e;const f=(0,d.useRouter)(),{id:x}=f.query,b=(0,$.sm)(h),{palette:k,spacing:D,typography:I}=(0,c.Fg)(),{query:T,selectedFields:N}=(0,s.useMemo)((()=>{let e=Object.entries(b.fields).filter((e=>{let[t,i]=e;return"hidden"!==i.itemView.fieldMode||"id"===t})).map((e=>{let[t]=e;return b.fields[t].controller.graphqlSelection})).join("\n");return{selectedFields:e,query:F.Ps`
        query ItemPage($id: ID!, $listKey: String!) {
          item: ${b.gqlNames.itemQueryName}(where: {id: $id}) {
            ${e}
          }
          keystone {
            adminMeta {
              list(key: $listKey) {
                hideCreate
                hideDelete
                fields {
                  path
                  itemView(id: $id) {
                    fieldMode
                  }
                }
              }
            }
          }
        }
      `}}),[b]);let{data:R,error:z,loading:L}=(0,C.a)(T,{variables:{id:x,listKey:h},errorPolicy:"all",skip:void 0===x});L||(L=void 0===x);const Q=(0,w.m)(R,null===z||void 0===z?void 0:z.graphQLErrors);let V=(0,s.useMemo)((()=>{var e,t,i,l,a;let n={};return null===(e=Q.data)||void 0===e||null===(t=e.keystone)||void 0===t||null===(i=t.adminMeta)||void 0===i||null===(l=i.list)||void 0===l||null===(a=l.fields)||void 0===a||a.forEach((e=>{var t;null!==e&&null!==e.path&&null!=(null===e||void 0===e||null===(t=e.itemView)||void 0===t?void 0:t.fieldMode)&&(n[e.path]=e.itemView.fieldMode)})),n}),[null===(t=Q.data)||void 0===t||null===(i=t.keystone)||void 0===i||null===(a=i.adminMeta)||void 0===a||null===(o=a.list)||void 0===o?void 0:o.fields]);const X=Q.get("keystone").errors,O=L?void 0:R&&R.item&&(R.item[b.labelField]||R.item.id)||x;return(0,c.tZ)(E.P,{title:O,header:(0,c.tZ)(S,{css:{alignItems:"center",display:"flex",flex:1,justifyContent:"space-between"}},(0,c.tZ)("div",{css:{alignItems:"center",display:"flex",flex:1,minWidth:0}},(0,c.tZ)(c.X6,{type:"h3"},(0,c.tZ)(r(),{href:`/${b.path}`,passHref:!0},(0,c.tZ)("a",{css:{textDecoration:"none"}},b.label))),(0,c.tZ)("div",{css:{color:k.neutral500,marginLeft:D.xsmall,marginRight:D.xsmall}},(0,c.tZ)(v.X,null)),(0,c.tZ)(c.X6,{as:"h1",type:"h3",css:{minWidth:0,maxWidth:"100%",overflow:"hidden",flex:1,textOverflow:"ellipsis",whiteSpace:"nowrap"}},L?"Loading...":R&&R.item&&(R.item[b.labelField]||R.item.id)||x)),!1)},L?(0,c.tZ)(c.M5,{css:{height:`calc(100vh - ${E.H}px)`}},(0,c.tZ)(m.xg,{label:"Loading item data",size:"large",tone:"passive"})):X?(0,c.tZ)(c.xu,{marginY:"xlarge"},(0,c.tZ)(p.qX,{tone:"negative"},X[0].message)):(0,c.tZ)(K,null,null==(null===R||void 0===R?void 0:R.item)?(0,c.tZ)(c.xu,{marginY:"xlarge"},null!==z&&void 0!==z&&z.graphQLErrors.length||null!==z&&void 0!==z&&z.networkError?(0,c.tZ)(M.G,{errors:null===z||void 0===z?void 0:z.graphQLErrors,networkError:null===z||void 0===z?void 0:z.networkError}):(0,c.tZ)(p.qX,{tone:"negative"},'The item with id "',x,"\" could not be found or you don't have access to it.")):(0,c.tZ)(s.Fragment,null,(0,c.tZ)(q,{fieldModes:V,selectedFields:N,showDelete:!R.keystone.adminMeta.list.hideDelete,listKey:h,itemGetter:Q.get("item")}),(0,c.tZ)(P,null,(0,c.tZ)(Z.Qy,null,"Item ID"),(0,c.tZ)("div",{css:{display:"flex",alignItems:"center"}},(0,c.tZ)(Z.oi,{css:{marginRight:D.medium,fontFamily:I.fontFamily.monospace,fontSize:I.fontSize.small},readOnly:!0,value:R.item.id}),(0,c.tZ)(y.u,{content:"Copy ID"},(e=>(0,c.tZ)(u.zx,(0,l.Z)({},e,{"aria-label":"Copy ID",onClick:()=>{n()(R.item.id)}}),(0,c.tZ)(g.K,{size:"small"})))))))))},L=(0,s.memo)((function(e){let{hasChangedFields:t,loading:i,onSave:l,onReset:a,deleteButton:n}=e;const{colors:o,spacing:r}=(0,c.Fg)();return(0,c.tZ)("div",{css:{background:o.background,borderTop:`1px solid ${o.border}`,bottom:0,display:"flex",justifyContent:"space-between",marginTop:r.xlarge,paddingBottom:r.xlarge,paddingTop:r.xlarge,position:"sticky",zIndex:20}},(0,c.tZ)(c.Kq,{align:"center",across:!0,gap:"small"},(0,c.tZ)(u.zx,{isDisabled:!t,isLoading:i,weight:"bold",tone:"active",onClick:l},"Save changes"),t?(0,c.tZ)(u.zx,{weight:"none",onClick:a},"Reset changes"):(0,c.tZ)(c.xv,{weight:"medium",paddingX:"large",color:"neutral600"},"No changes")),n)})),K=e=>{const{spacing:t}=(0,c.Fg)();return(0,c.tZ)(S,{css:{position:"relative",height:"100%"}},(0,c.tZ)("div",(0,l.Z)({css:{alignItems:"start",display:"grid",gap:t.xlarge,gridTemplateColumns:"2fr 1fr"}},e)))},P=e=>{const{spacing:t}=(0,c.Fg)();return(0,c.tZ)("div",(0,l.Z)({css:{marginTop:t.xlarge,marginBottom:t.xxlarge,position:"sticky",top:t.xlarge}},e))}},2129:function(e,t,i){"use strict";i.d(t,{K:function(){return n}});var l=i(1902),a=i(5311);i(1053);const n=(0,a.c)(l.createElement(l.Fragment,null,l.createElement("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),l.createElement("rect",{x:8,y:2,width:8,height:4,rx:1,ry:1})),"ClipboardIcon")},9505:function(e){function t(){return new DOMException("The request is not allowed","NotAllowedError")}e.exports=async function(e){try{await async function(e){if(!navigator.clipboard)throw t();return navigator.clipboard.writeText(e)}(e)}catch(i){try{await async function(e){const i=document.createElement("span");i.textContent=e,i.style.whiteSpace="pre",i.style.webkitUserSelect="auto",i.style.userSelect="all",document.body.appendChild(i);const l=window.getSelection(),a=window.document.createRange();l.removeAllRanges(),a.selectNode(i),l.addRange(a);let n=!1;try{n=window.document.execCommand("copy")}finally{l.removeAllRanges(),window.document.body.removeChild(i)}if(!n)throw t()}(e)}catch(l){throw l||i||t()}}}}}]);